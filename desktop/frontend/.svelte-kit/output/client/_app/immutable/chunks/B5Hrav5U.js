const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dvEzbItq.js","./DBavZ5B7.js","./Bb6-my-h.js","./T1mY9Bsz.js","./B_oE_bSN.js","./BNe5zU4k.js"])))=>i.map(i=>d[i]);
import{p as e,i as t,c as a,s,a as r,b as n,_ as i}from"./B_oE_bSN.js";import"./DBavZ5B7.js";import{w as l,g as c,o,s as d,d as u,b as h}from"./T1mY9Bsz.js";import{D as f,z as v,ai as p,G as g,A as m,y as x,g as y,Y as k,B as b,H as w,C,F as _,N as E,aj as L,an as S,I as T,K as R,J as M,ar as A,af as D,R as j,aE as N,aF as I,L as z,M as U,aG as F,aH as H,aI as W,aJ as P,aK as $,al as B,aL as O,aq as K,aM as V,W as q,aN as G,a8 as J,aO as Q,aP as Y,aQ as X,aR as Z,aS as ee,aT as te,aa as ae,n as se,a7 as re,aU as ne,p as ie,i as le,j as ce,d as oe,e as de,h as ue,s as he,f as fe,c as ve,r as pe,t as ge,a as me,b as xe,aV as ye}from"./Bb6-my-h.js";function ke(e,t){return t}function be(e,t,a,s,r,n=null){var i=e,l={flags:t,items:new Map,first:null};if(0!==(t&G)){var c=e;i=v?f(p(c)):c.appendChild(g())}v&&m();var o,d,u=null,h=!1,j=new Map,N=k(()=>{var e=a();return D(e)?e:null==e?[]:A(e)});function I(){!function(e,t,a,s,r,n,i,l,c){var o,d,u,h,f,v,p,g,m,x,y=0!==(i&Q),k=0!==(i&(P|F)),b=t.length,w=a.items,C=a.first,_=C,E=null,L=[],S=[];if(y)for(x=0;x<b;x+=1)g=l(p=t[x],x),void 0!==(m=w.get(g))&&(null==(o=m.a)||o.measure(),(v??(v=new Set)).add(m));for(x=0;x<b;x+=1)if(g=l(p=t[x],x),void 0!==(m=w.get(g))){if(k&&we(m,p,x,i),0!==(m.e.f&H)&&(z(m.e),y&&(null==(d=m.a)||d.unfix(),(v??(v=new Set)).delete(m))),m!==_){if(void 0!==f&&f.has(m)){if(L.length<S.length){var T,R=S[0];E=R.prev;var M=L[0],D=L[L.length-1];for(T=0;T<L.length;T+=1)_e(L[T],R,r);for(T=0;T<S.length;T+=1)f.delete(S[T]);Ee(a,M.prev,D.next),Ee(a,E,M),Ee(a,D,R),_=R,E=D,x-=1,L=[],S=[]}else f.delete(m),_e(m,_,r),Ee(a,m.prev,m.next),Ee(a,m,null===E?a.first:E.next),Ee(a,E,m),E=m;continue}for(L=[],S=[];null!==_&&_.k!==g;)0===(_.e.f&H)&&(f??(f=new Set)).add(_),S.push(_),_=_.next;if(null===_)continue;m=_}L.push(m),E=m,_=m.next}else{var j=s.get(g);if(void 0!==j){s.delete(g),w.set(g,j);var N=E?E.next:_;Ee(a,E,j),Ee(a,j,N),_e(j,N,r),E=j}else{E=Ce(_?_.e.nodes_start:r,a,E,null===E?a.first:E.next,p,g,x,n,i,c)}w.set(g,E),L=[],S=[],_=E.next}if(null!==_||void 0!==f){for(var I=void 0===f?[]:A(f);null!==_;)0===(_.e.f&H)&&I.push(_),_=_.next;var U=I.length;if(U>0){var $=0!==(i&G)&&0===b?r:null;if(y){for(x=0;x<U;x+=1)null==(u=I[x].a)||u.measure();for(x=0;x<U;x+=1)null==(h=I[x].a)||h.fix()}!function(e,t,a){for(var s=e.items,r=[],n=t.length,i=0;i<n;i++)O(t[i].e,r,!0);var l=n>0&&0===r.length&&null!==a;if(l){var c=a.parentNode;K(c),c.append(a),s.clear(),Ee(e,t[0].prev,t[n-1].next)}V(r,()=>{for(var a=0;a<n;a++){var r=t[a];l||(s.delete(r.k),Ee(e,r.prev,r.next)),W(r.e,!l)}})}(a,I,$)}}y&&J(()=>{var e;if(void 0!==v)for(m of v)null==(e=m.a)||e.apply()});for(var B of(e.first=a.first&&a.first.e,e.last=E&&E.e,s.values()))W(B.e);s.clear()}(d,o,l,j,i,r,t,s,a),null!==n&&(0===o.length?u?z(u):u=T(()=>n(i)):null!==u&&U(u,()=>{u=null}))}x(()=>{d??(d=q);var e=(o=y(N)).length;if(h&&0===e)return;h=0===e;let c=!1;v&&(b(i)===w!==(0===e)&&(i=C(),f(i),_(!1),c=!0));if(v){for(var p,g=null,m=0;m<e;m++){if(E.nodeType===L&&E.data===S){i=E,c=!0,_(!1);break}var x=o[m],k=s(x,m);p=Ce(E,l,g,null,x,k,m,r,t,a),l.items.set(k,p),g=p}e>0&&f(C())}if(v)0===e&&n&&(u=T(()=>n(i)));else if(R()){var A=new Set,D=M;for(m=0;m<e;m+=1){x=o[m],k=s(x,m);var z=l.items.get(k)??j.get(k);z?0!==(t&(P|F))&&we(z,x,m,t):(p=Ce(null,l,null,null,x,k,m,r,t,a,!0),j.set(k,p)),A.add(k)}for(const[e,t]of l.items)A.has(e)||D.skipped_effects.add(t.e);D.add_callback(I)}else I();c&&_(!0),y(N)}),v&&(i=E)}function we(e,t,a,s){0!==(s&P)&&I(e.v,t),0!==(s&F)?I(e.i,a):e.i=a}function Ce(e,t,a,s,r,n,i,l,c,o,d){var u=0!==(c&P)?0===(c&$)?j(r,!1,!1):N(r):r,h=0===(c&F)?i:N(i),f={i:h,v:u,k:n,a:null,e:null,prev:a,next:s};try{if(null===e)document.createDocumentFragment().append(e=g());return f.e=T(()=>l(e,u,h,o),v),f.e.prev=a&&a.e,f.e.next=s&&s.e,null===a?d||(t.first=f):(a.next=f,a.e.next=f.e),null!==s&&(s.prev=f,s.e.prev=f.e),f}finally{}}function _e(e,t,a){for(var s=e.next?e.next.e.nodes_start:a,r=t?t.e.nodes_start:a,n=e.e.nodes_start;null!==n&&n!==s;){var i=B(n);r.before(n),n=i}}function Ee(e,t,a){null===t?e.first=a:(t.next=a,t.e.next=a&&a.e),null!==a&&(a.prev=t,a.e.prev=t&&t.e)}const Le=Symbol("is custom element"),Se=Symbol("is html");function Te(e){if(v){var t=!1,a=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var a=e.value;Re(e,"value",null),e.value=a}if(e.hasAttribute("checked")){var s=e.checked;Re(e,"checked",null),e.checked=s}}};e.__on_r=a,Y(a),X()}}function Re(e,t,a,s){var r=function(e){return e.__attributes??(e.__attributes={[Le]:e.nodeName.includes("-"),[Se]:e.namespaceURI===ee})}(e);v&&(r[t]=e.getAttribute(t),"src"===t||"srcset"===t||"href"===t&&"LINK"===e.nodeName)||r[t]!==(r[t]=a)&&("loading"===t&&(e[Z]=a),e.removeAttribute(t))}function Me(e,t,a=t){var s=new WeakSet;te(e,"input",async r=>{var n=r?e.defaultValue:e.value;if(n=Ae(e)?De(n):n,a(n),null!==M&&s.add(M),await ae(),n!==(n=t())){var i=e.selectionStart,l=e.selectionEnd;e.value=n??"",null!==l&&(e.selectionStart=i,e.selectionEnd=Math.min(l,e.value.length))}}),(v&&e.defaultValue!==e.value||null==se(t)&&e.value)&&(a(Ae(e)?De(e.value):e.value),null!==M&&s.add(M)),re(()=>{var a=t();if(e===document.activeElement){var r=ne??M;if(s.has(r))return}Ae(e)&&a===De(e.value)||("date"!==e.type||a||e.value)&&a!==e.value&&(e.value=a??"")})}function Ae(e){var t=e.type;return"number"===t||"range"===t}function De(e){return""===e?null:+e}async function je(e,t={},a){return window.__TAURI_INTERNALS__.invoke(e,t,a)}"function"==typeof SuppressedError&&SuppressedError;class Ne{constructor(){this.initialized=!1,this.cache=new Map,this.cacheTTL=3e5,this.maxCacheSize=100,this.retryConfig={maxAttempts:3,backoffMs:1e3,maxBackoffMs:1e4,jitter:!0},this.metrics={totalCalls:0,successfulCalls:0,failedCalls:0,cacheHits:0,averageLatency:0},this.status=l("disconnected"),this.lastError=l(null),this.isLoading=l(!1),window.__TAURI__&&this.connect(),setInterval(()=>this.cleanupCache(),6e4)}async connect(){try{this.status.set("connecting"),await je("start_mcp_backend");const e=await this.callWithRetry("server_info",{});return e.ok?(this.initialized=!0,this.status.set("connected"),{ok:!0,data:void 0}):(this.status.set("error"),e)}catch(e){const t=this.formatError(e);return this.status.set("error"),this.lastError.set(t),{ok:!1,error:t}}}async disconnect(){try{await je("stop_mcp_backend"),this.initialized=!1,this.status.set("disconnected"),this.cache.clear()}catch(e){}}async callWithRetry(e,t={},a={}){const s=performance.now();if(this.metrics.totalCalls++,!a.skipCache){const a=this.getFromCache(e,t);if(a)return this.metrics.cacheHits++,{ok:!0,data:a}}const r=await this.callWithExponentialBackoff(e,t,1,a.fallback),n=performance.now()-s;return this.updateLatencyMetric(n),r.ok?(this.metrics.successfulCalls++,this.saveToCache(e,t,r.data,a.cacheTTL)):this.metrics.failedCalls++,r}async callWithExponentialBackoff(e,t,a,s){try{this.isLoading.set(!0);const a=await je("mcp_call",{method:e,params:t});return this.isLoading.set(!1),{ok:!0,data:a}}catch(r){this.isLoading.set(!1);const n=this.formatError(r);if(a<this.retryConfig.maxAttempts&&this.isRetriableError(n)){const r=this.calculateBackoff(a);return await this.delay(r),this.callWithExponentialBackoff(e,t,a+1,s)}if(void 0!==s)return this.status.set("degraded"),{ok:!0,data:s};const i=this.getFromCache(e,t,!0);return i?(this.status.set("degraded"),{ok:!0,data:i}):(this.lastError.set(n),{ok:!1,error:n})}}calculateBackoff(e){let t=Math.min(this.retryConfig.backoffMs*Math.pow(2,e-1),this.retryConfig.maxBackoffMs);if(this.retryConfig.jitter){t+=.25*t*(2*Math.random()-1)}return Math.max(t,0)}isRetriableError(e){return["not running","disconnected","timeout","ECONNREFUSED","EPIPE","ENOTFOUND"].some(t=>e.toLowerCase().includes(t.toLowerCase()))}getFromCache(e,t,a=!1){const s=this.getCacheKey(e,t),r=this.cache.get(s);if(!r)return null;return Date.now()-r.timestamp<=this.cacheTTL||a?(r.hits++,r.data):null}saveToCache(e,t,a,s){this.cache.size>=this.maxCacheSize&&this.evictLeastUsed();const r=this.getCacheKey(e,t);this.cache.set(r,{data:a,timestamp:Date.now(),hits:0}),s&&setTimeout(()=>{this.cache.delete(r)},s)}evictLeastUsed(){let e=null,t=1/0;for(const a of this.cache.entries()){const s=a[1].hits+(Date.now()-a[1].timestamp)/1e3;s<t&&(t=s,e=a)}e&&this.cache.delete(e[0])}cleanupCache(){const e=Date.now(),t=[];for(const[a,s]of this.cache.entries())e-s.timestamp>this.cacheTTL&&t.push(a);t.forEach(e=>this.cache.delete(e))}getCacheKey(e,t){return`${e}:${JSON.stringify(t)}`}sanitizeForLogging(e){const t=["password","token","secret","key","auth"],a={...e};for(const s of Object.keys(a))t.some(e=>s.toLowerCase().includes(e))&&(a[s]="[REDACTED]");return a}formatError(e){return"string"==typeof e?e:(null==e?void 0:e.message)?e.message:(null==e?void 0:e.toString)?e.toString():"Unknown error occurred"}delay(e){return new Promise(t=>setTimeout(t,e))}updateLatencyMetric(e){this.metrics.averageLatency=.9*this.metrics.averageLatency+.1*e}getMetrics(){return{...this.metrics,cacheHitRate:this.metrics.cacheHits/Math.max(1,this.metrics.totalCalls),successRate:this.metrics.successfulCalls/Math.max(1,this.metrics.totalCalls),cacheSize:this.cache.size}}clearCache(){this.cache.clear()}resetMetrics(){this.metrics={totalCalls:0,successfulCalls:0,failedCalls:0,cacheHits:0,averageLatency:0}}async getHealth(){const e=[],t=c(this.lastError);return t&&e.push(t),{status:c(this.status),metrics:this.getMetrics(),errors:e}}async search(e,t={}){return this.callWithRetry("search",{query:e,...t},{fallback:{results:[],query:e,error:"Search temporarily unavailable"}})}async rollDice(e){return this.callWithRetry("roll_dice",{notation:e},{skipCache:!0})}async listSources(){return this.callWithRetry("list_sources",{},{cacheTTL:6e5,fallback:{sources:[]}})}}let Ie=null;function ze(){return Ie||(Ie=new Ne),Ie}const Ue=l("disconnected"),Fe=l(null),He=l(!1);var We=fe('<div class="flex items-center justify-center p-4"><span class="text-gray-500"> </span></div>'),Pe=fe('<div class="flex items-center justify-center p-4"><span class="text-red-500"> </span></div>');function $e(r,n){ie(n,!0);let i=e(n,"delay",3,0),l=e(n,"fallback",3,"Loading..."),c=e(n,"props",19,()=>({})),u=he(null),h=he(!0),f=he(null);o(async()=>{try{i()>0&&await new Promise(e=>setTimeout(e,i()));const e=await n.component();ue(u,e.default,!0),ue(h,!1)}catch(e){ue(f,e instanceof Error?e.message:"Failed to load component",!0),ue(h,!1)}});var v=le(),p=ce(v),g=e=>{var t=We(),a=ve(t),s=ve(a,!0);pe(a),pe(t),ge(()=>d(s,l())),oe(e,t)},m=e=>{var r=le(),n=ce(r),i=e=>{var t=Pe(),a=ve(t),s=ve(a);pe(a),pe(t),ge(()=>d(s,`Error: ${y(f)??""}`)),oe(e,t)},l=e=>{var r=le(),n=ce(r),i=e=>{var t=le(),r=ce(t);a(r,()=>y(u),(e,t)=>{t(e,s(c))}),oe(e,t)};t(n,e=>{y(u)&&e(i)},!0),oe(e,r)};t(n,e=>{y(f)?e(i):e(l,!1)},!0),oe(e,r)};t(p,e=>{y(h)?e(g):e(m,!1)}),oe(r,v),de()}u(["click"]);var Be=fe('<span class="w-2 h-2 bg-green-500 rounded-full"></span> <span class="text-sm text-green-600 dark:text-green-400">Connected</span>',1),Oe=fe('<span class="w-2 h-2 bg-yellow-500 rounded-full animate-pulse"></span> <span class="text-sm text-yellow-600 dark:text-yellow-400">Connecting...</span>',1),Ke=fe('<span class="w-2 h-2 bg-orange-500 rounded-full"></span> <span class="text-sm text-orange-600 dark:text-orange-400">Degraded</span>',1),Ve=fe('<span class="w-2 h-2 bg-red-500 rounded-full"></span> <span class="text-sm text-red-600 dark:text-red-400">Error</span>',1),qe=fe('<span class="w-2 h-2 bg-gray-500 rounded-full"></span> <span class="text-sm text-gray-600 dark:text-gray-400">Disconnected</span>',1),Ge=(e,t)=>"Enter"===e.key&&t(),Je=fe('<div class="mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"><p class="text-sm text-red-600 dark:text-red-400"> </p></div>'),Qe=fe('<div class="mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"><p class="text-sm text-red-600 dark:text-red-400"> </p></div>'),Ye=fe('<p class="mt-2 text-xs text-gray-500 dark:text-gray-500"> </p>'),Xe=fe('<div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"><h4 class="font-semibold text-gray-900 dark:text-white"> </h4> <p class="mt-1 text-sm text-gray-600 dark:text-gray-400"> </p> <!></div>'),Ze=fe('<div class="mt-6 space-y-3"><h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300"> </h3> <!></div>'),et=fe('<div class="min-h-screen bg-gray-50 dark:bg-gray-900"><header class="bg-white dark:bg-gray-800 shadow"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"><div class="flex items-center justify-between"><h1 class="text-2xl font-bold text-gray-900 dark:text-white">TTRPG Assistant</h1> <div class="flex items-center gap-2"><span class="text-sm text-gray-600 dark:text-gray-400">MCP Status:</span> <span class="flex items-center gap-1"><!></span></div></div></div></header> <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6"><h2 class="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Search Rules & Content</h2> <div class="flex gap-2"><input type="text" placeholder="Search for rules, spells, monsters..." class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg\n                           bg-white dark:bg-gray-700 text-gray-900 dark:text-white\n                           focus:outline-none focus:ring-2 focus:ring-blue-500"/> <button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\n                           disabled:opacity-50 disabled:cursor-not-allowed\n                           transition-colors duration-200"> </button></div> <!> <!> <!></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><!> <!></div></main> <!></div>');function tt(e,a){ie(a,!0);const[s,l]=r(),c=()=>n(Ue,"$mcpStatus",s),u=()=>n(He,"$mcpLoading",s),f=()=>n(Fe,"$mcpError",s);let v=he(""),p=he(me([])),g=he(null);async function m(){var e;if(!y(v).trim())return;const t=ze(),a=await t.search(y(v));a.ok?(Array.isArray(a.data)?ue(p,a.data,!0):(null==(e=a.data)?void 0:e.results)?ue(p,a.data.results,!0):ue(p,[],!0),ue(g,null)):(ue(g,a.error||"Unknown error occurred",!0),ue(p,[],!0))}o(async()=>{const e=ze();await e.connect()});var x=et(),k=ve(x),b=ve(k),w=ve(b),C=xe(ve(w),2),_=xe(ve(C),2),E=ve(_),L=e=>{var t=Be();ye(2),oe(e,t)},S=e=>{var a=le(),s=ce(a),r=e=>{var t=Oe();ye(2),oe(e,t)},n=e=>{var a=le(),s=ce(a),r=e=>{var t=Ke();ye(2),oe(e,t)},n=e=>{var a=le(),s=ce(a),r=e=>{var t=Ve();ye(2),oe(e,t)},n=e=>{var t=qe();ye(2),oe(e,t)};t(s,e=>{"error"===c()?e(r):e(n,!1)},!0),oe(e,a)};t(s,e=>{"degraded"===c()?e(r):e(n,!1)},!0),oe(e,a)};t(s,e=>{"connecting"===c()?e(r):e(n,!1)},!0),oe(e,a)};t(E,e=>{"connected"===c()?e(L):e(S,!1)}),pe(_),pe(C),pe(w),pe(b),pe(k);var T=xe(k,2),R=ve(T),M=xe(ve(R),2),A=ve(M);Te(A),A.__keydown=[Ge,m];var D=xe(A,2);D.__click=m;var j=ve(D,!0);pe(D),pe(M);var N=xe(M,2),I=e=>{var t=Je(),a=ve(t),s=ve(a,!0);pe(a),pe(t),ge(()=>d(s,f())),oe(e,t)};t(N,e=>{f()&&e(I)});var z=xe(N,2),U=e=>{var t=Qe(),a=ve(t),s=ve(a);pe(a),pe(t),ge(()=>d(s,`Search error: ${y(g)??""}`)),oe(e,t)};t(z,e=>{y(g)&&e(U)});var F=xe(z,2),H=e=>{var a=Ze(),s=ve(a),r=ve(s);pe(s),be(xe(s,2),17,()=>y(p),ke,(e,a)=>{var s=Xe(),r=ve(s),n=ve(r,!0);pe(r);var i=xe(r,2),l=ve(i,!0);pe(i);var c=xe(i,2),o=e=>{var t=Ye(),s=ve(t);pe(t),ge(()=>d(s,`Source: ${y(a).source??""}`)),oe(e,t)};t(c,e=>{y(a).source&&e(o)}),pe(s),ge(()=>{d(n,y(a).title||"Untitled"),d(l,y(a).content||y(a).description||"No description")}),oe(e,s)}),pe(a),ge(()=>d(r,`Results (${y(p).length??""})`)),oe(e,a)};t(F,e=>{y(p).length>0&&e(H)}),pe(R);var W=xe(R,2),P=ve(W);$e(P,{component:()=>i(()=>import("./dvEzbItq.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),fallback:"Loading Campaign Manager..."}),$e(xe(P,2),{component:()=>i(()=>import("./BNe5zU4k.js"),__vite__mapDeps([5,1,2,3,4]),import.meta.url),fallback:"Loading Dice Roller...",delay:100}),pe(W),pe(T),function(e,a){ie(a,!0);let s,r=he(me({totalCalls:0,successfulCalls:0,failedCalls:0,cacheHits:0,averageLatency:0,cacheHitRate:0,successRate:0,cacheSize:0}));o(()=>{const e=()=>{const e=ze();e&&ue(r,e.getMetrics(),!0)};e(),s=window.setInterval(e,2e3)}),h(()=>{s&&clearInterval(s)});var n=le(),i=ce(n);t(i,e=>{}),oe(e,n),de()}(xe(T,2),{}),pe(x),ge(()=>{A.disabled="connected"!==c()&&"degraded"!==c(),D.disabled=u()||"connected"!==c()&&"degraded"!==c(),d(j,u()?"Searching...":"Search")}),Me(A,()=>y(v),e=>ue(v,e)),oe(e,x),de(),l()}u(["keydown","click"]);export{tt as _,Me as b,be as e,ze as g,ke as i,Te as r};
